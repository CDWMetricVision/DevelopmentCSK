<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <title>Alarm Page</title>
</head>
<body>
    <!-- Existing Content -->
    <div class="customer-logo">
        <img src="https://cskcustomer1.s3.us-east-1.amazonaws.com/custlogo.png" alt="CDW Logo">
    </div>
    <div class="main-container-wrapper">
        <div class="d-flex flex-wrap alarm-options-wrapper">
            <div class="d-flex">
                <label for="customerAccounts" class="mt-2">Accounts : </label>
                <select id="customerAccounts" class="p-2 cursor-pointer" onchange="customerAccountChange(event)">
                    <option disabled selected hidden>--Select--</option>
                    <option value="MAS Sandbox Development">MAS Sandbox Development</option>
                    <option value="MAS Sandbox Test1">MAS Sandbox Test1</option>
                    <option value="MAS Sandbox Test2">MAS Sandbox Test2</option>
                </select>
            </div>
            <div class="col d-flex justify-content-center">
                <button type="button" class="btn btn-primary w-20" id="getAlarmsData" onClick="getAlarmsData()" disabled>Go</button>
            </div>
        </div>
        
        <!-- Sort by dropdown -->
        <div class="sort-by-wrapper">
            <label for="sortBy" class="mr-2">Sort by:</label>
            <select id="sortBy" class="p-2 cursor-pointer" onchange="sortTable()">
                <option value="alarmNameAZ">AlarmName - A-Z</option>
                <option value="alarmNameZA">AlarmName - Z-A</option>
                <option value="stateInsufficient">State - INSUFFICIENT_DATA</option>
                <option value="stateAlarm">State - Alarm</option>
            </select>
        </div>

        <div class="w-100" id="dataTables">
            <div class="alarms-container" id="alarmsList">
                <table></table>
            </div>
        </div>
    </div>

    <script>
        function sortTable() {
            const sortBy = $("#sortBy").val();  // Get the selected sort option
            const table = $('#alarmsList table');
            const rows = Array.from(table.find('tbody tr'));

            let sortedRows = [];

            switch(sortBy) {
                case 'alarmNameAZ':
                    sortedRows = rows.sort((a, b) => {
                        const alarmA = $(a).find('td').eq(0).text().toLowerCase();
                        const alarmB = $(b).find('td').eq(0).text().toLowerCase();
                        return alarmA.localeCompare(alarmB);  // Sort A-Z
                    });
                    break;
                case 'alarmNameZA':
                    sortedRows = rows.sort((a, b) => {
                        const alarmA = $(a).find('td').eq(0).text().toLowerCase();
                        const alarmB = $(b).find('td').eq(0).text().toLowerCase();
                        return alarmB.localeCompare(alarmA);  // Sort Z-A
                    });
                    break;
                case 'stateInsufficient':
                    sortedRows = rows.sort((a, b) => {
                        const stateA = $(a).find('td').eq(1).text().toLowerCase();
                        const stateB = $(b).find('td').eq(1).text().toLowerCase();
                        return stateA === 'insufficient_data' ? -1 : 1;  // Sort INSUFFICIENT_DATA to top
                    });
                    break;
                case 'stateAlarm':
                    sortedRows = rows.sort((a, b) => {
                        const stateA = $(a).find('td').eq(1).text().toLowerCase();
                        const stateB = $(b).find('td').eq(1).text().toLowerCase();
                        return stateA === 'alarm' ? -1 : 1;  // Sort ALARM to top
                    });
                    break;
            }

            // Reorder the rows in the table
            table.find('tbody').empty().append(sortedRows);
        }

        function createTable(alarms) {
            const table = $('#alarmsList table');
            
            // Clear existing table content
            table.empty();
            
            // Create table header
            const headers = Object.keys(alarms[0]);
            let headerHtml = '<thead><tr>';
            
            headers.forEach(headerText => {
                headerHtml += `<th>${headerText}</th>`;
            });
            
            headerHtml += '</tr></thead>';
            table.append(headerHtml);
            
            // Create table body
            let bodyHtml = '<tbody>';
            
            alarms.forEach(alarm => {
                bodyHtml += '<tr>';
                headers.forEach(header => {
                    bodyHtml += `<td>${alarm[header]}</td>`;
                });
                bodyHtml += '</tr>';
            });
            
            bodyHtml += '</tbody>';
            table.append(bodyHtml);
        }
    </script>
</body>
</html>
